<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Форум Ethernity</title>
  <style>
    /* === Базовые стили (вернул твоё оформление) === */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1e1e2f;
      color: #eee;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #222233;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.7);
    }
    .logo {
      height: 40px;
      cursor: pointer;
    }
    #header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    #header-right button {
      background: #444466;
      border: none;
      color: #eee;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: 600;
      transition: background 0.3s ease;
    }
    #header-right button:hover {
      background: #666699;
    }
    main {
      flex: 1;
      display: flex;
      padding: 20px;
      background: #2a2a3e;
      gap: 30px;
    }

    /* === Авторизация справа === */
    #auth-section {
      min-width: 260px;
      background: #33334d;
      padding: 20px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 0 15px #000a;
      align-self: flex-start;
    }
    #auth-section h2 {
      margin-top: 0;
      font-weight: 700;
      text-align: center;
      color: #ddd;
    }
    #auth-section input {
      padding: 8px;
      border-radius: 4px;
      border: none;
      font-size: 15px;
    }
    #auth-section input:focus {
      outline: 2px solid #7788ff;
      background: #454566;
      color: #eee;
    }
    #btn-login {
      background: #5566cc;
      color: white;
      border: none;
      font-weight: 700;
      cursor: pointer;
      padding: 10px;
      border-radius: 6px;
      transition: background 0.3s ease;
    }
    #btn-login:hover {
      background: #7788ff;
    }
    #auth-messages.error {
      color: #ff6060;
      font-weight: 600;
      text-align: center;
    }
    #auth-messages.success {
      color: #80ff80;
      font-weight: 600;
      text-align: center;
    }

    /* === Темы по центру === */
    #topics-list-section {
      flex: 1;
      max-width: 720px;
      display: flex;
      flex-direction: column;
      background: #242447;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px #000c;
    }
    #topics-list-section h2 {
      margin-top: 0;
      font-weight: 700;
      color: #ccdcee;
      text-align: center;
      margin-bottom: 16px;
    }
    #topics-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .topic {
      background: #3a3a5a;
      padding: 14px 16px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.3s ease;
    }
    .topic:hover {
      background: #4e4e7a;
    }
    .topic-header {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }
    .topic-title {
      font-size: 18px;
      font-weight: 700;
      color: #aaddff;
      user-select: none;
    }
    .topic-title:hover {
      text-decoration: underline;
    }
    .btn-small {
      background: #555577;
      border: none;
      color: #eee;
      padding: 4px 8px;
      font-size: 13px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .btn-small:hover {
      background: #8888bb;
    }
    .pagination {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      gap: 8px;
    }
    .pagination button {
      background: #555577;
      border: none;
      color: #eee;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s ease;
    }
    .pagination button:disabled {
      background: #222244;
      cursor: default;
    }
    .pagination button:hover:not(:disabled) {
      background: #8899ff;
    }

    /* === Посты === */
    #posts-section {
      flex: 1;
      max-width: 720px;
      display: flex;
      flex-direction: column;
      background: #2a2a4f;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 20px #000c;
    }
    #posts-section h2 {
      font-weight: 700;
      margin-top: 0;
      color: #cceeff;
      margin-bottom: 12px;
      text-align: center;
    }
    #posts-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 10px;
    }
    .post {
      background: #444477;
      border-radius: 8px;
      padding: 12px 14px;
      box-shadow: inset 0 0 10px #111133;
    }
    .post-header {
      font-size: 13px;
      color: #ccc;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .post-content {
      white-space: pre-wrap;
      color: #eee;
      font-size: 15px;
    }

    /* === Создание темы и поста === */
    #create-topic-section,
    #create-post-section {
      background: #3c3c6c;
      padding: 15px 20px;
      border-radius: 8px;
      margin-top: 10px;
    }
    #create-topic-section h2,
    #create-post-section h3 {
      margin-top: 0;
      color: #bbddff;
    }
    #topic-title,
    #post-content {
      width: 100%;
      border-radius: 6px;
      border: none;
      padding: 10px;
      font-size: 15px;
      font-family: inherit;
      margin-top: 8px;
      resize: vertical;
      background: #222244;
      color: #ddd;
      box-shadow: inset 0 0 5px #000a;
      transition: box-shadow 0.3s ease;
    }
    #topic-title:focus,
    #post-content:focus {
      outline: none;
      box-shadow: 0 0 8px #7788ff;
      background: #333366;
    }
    #btn-create-topic,
    #btn-create-post {
      margin-top: 10px;
      background: #5577cc;
      border: none;
      color: white;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.3s ease;
    }
    #btn-create-topic:hover,
    #btn-create-post:hover {
      background: #7799ff;
    }
    .error {
      color: #ff6666;
      font-weight: 600;
      margin-top: 6px;
    }
    .hidden {
      display: none;
    }

    /* === Инфо текст === */
    .info-text {
      font-style: italic;
      color: #8888aa;
      text-align: center;
      margin-top: 20px;
    }

    /* === Пользовательская инфа (аватар и подпись) === */
    #user-info {
      margin-top: 20px;
      background: #3a3a5a;
      padding: 10px 16px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 0 10px #0008 inset;
    }
    #user-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #666688;
      color: #ddd;
      font-weight: 700;
      font-size: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      box-shadow: 0 0 8px #0008;
    }
    #current-username {
      font-weight: 700;
      font-size: 18px;
      color: #aaddff;
    }
    #current-role {
      margin-left: 8px;
      font-weight: 700;
      font-size: 15px;
      padding: 2px 8px;
      border-radius: 12px;
      color: #eee;
      user-select: none;
    }
    /* Неоновый эффект для админа */
    #current-role.admin {
      color: #00ffff;
      text-shadow:
        0 0 5px #00ffff,
        0 0 10px #00ffff,
        0 0 20px #00ffff,
        0 0 30px #00ffff,
        0 0 40px #00ffff;
      font-weight: 900;
    }
  </style>
</head>
<body>
  <header>
    <img class="logo" src="https://ethernity.site/assets/images/logo_ethernity.svg" alt="Ethernity logo" />
    <div id="header-right">
      <!-- Здесь будут кнопки выхода и смены темы -->
    </div>
  </header>

  <main>
    <!-- Центр: список тем -->
    <section id="topics-list-section" aria-label="Список тем форума">
      <h2>Темы форума</h2>
      <div id="topics-list" aria-live="polite"></div>
      <div class="pagination" id="topics-pagination"></div>

      <!-- Создание темы (только для авторизованных) -->
      <div id="create-topic-section" class="hidden" aria-label="Создать новую тему">
        <h2>Создать тему</h2>
        <input id="topic-title" type="text" placeholder="Название темы" maxlength="100" />
        <div id="topic-error" class="error hidden">Введите название темы (3-100 символов)</div>
        <button id="btn-create-topic">Создать тему</button>
      </div>
    </section>

    <!-- Справа: авторизация и профиль -->
    <aside id="auth-section" aria-label="Авторизация и профиль пользователя">
      <h2>Авторизация</h2>
      <input id="input-username" type="text" placeholder="Имя пользователя" maxlength="20" autocomplete="username" />
      <input id="input-password" type="password" placeholder="Пароль" autocomplete="current-password" />
      <button id="btn-login">Войти</button>
      <div id="auth-messages" role="alert" aria-live="assertive"></div>

      <!-- Профиль пользователя -->
      <div id="user-info" class="hidden" aria-label="Профиль пользователя">
        <div id="user-avatar" aria-hidden="true"></div>
        <div>
          <div id="current-username"></div>
          <div id="current-role" class=""></div>
        </div>
        <button id="btn-logout" title="Выйти из аккаунта" aria-label="Выйти">Выйти</button>
      </div>
    </aside>
  </main>

  <script>
    // === Переменные и начальные данные ===
    const localStorageKey = 'simple_forum_data';
    const localStorageThemeKey = 'forum_theme';

    const btnLogin = document.getElementById('btn-login');
    const btnLogout = document.getElementById('btn-logout');
    const inputUsername = document.getElementById('input-username');
    const inputPassword = document.getElementById('input-password');
    const authMessages = document.getElementById('auth-messages');

    const userInfo = document.getElementById('user-info');
    const userAvatar = document.getElementById('user-avatar');
    const currentUsernameEl = document.getElementById('current-username');
    const currentRoleEl = document.getElementById('current-role');

    const topicsList = document.getElementById('topics-list');
    const topicsPagination = document.getElementById('topics-pagination');

    const createTopicSection = document.getElementById('create-topic-section');
    const topicTitleInput = document.getElementById('topic-title');
    const topicError = document.getElementById('topic-error');
    const btnCreateTopic = document.getElementById('btn-create-topic');

    const headerRight = document.getElementById('header-right');

    let data = {
      users: [],
      topics: [],
      currentUser: null,
    };

    // === Загрузка данных из localStorage ===
    function loadData() {
      const raw = localStorage.getItem(localStorageKey);
      if (raw) {
        try {
          data = JSON.parse(raw);
        } catch {
          data = { users: [], topics: [], currentUser: null };
        }
      }
      if (!data.users.length) {
        // Создаем админа по умолчанию
        data.users.push({
          username: 'admin',
          password: 'admin',
          role: 'admin',
          avatar: null,
        });
      }
    }

    function saveData() {
      localStorage.setItem(localStorageKey, JSON.stringify(data));
    }

    // === Функции для авторизации ===
    function clearAuthMessage() {
      authMessages.textContent = '';
      authMessages.className = '';
    }

    function setAuthMessage(text, isError = true) {
      authMessages.textContent = text;
      authMessages.className = isError ? 'error' : 'success';
    }

    function login(username, password) {
      clearAuthMessage();
      if (!username || !password) {
        return setAuthMessage('Введите имя пользователя и пароль');
      }
      const user = data.users.find(u => u.username.toLowerCase() === username.toLowerCase());
      if (!user) {
        return setAuthMessage('Пользователь не найден');
      }
      if (user.password !== password) {
        return setAuthMessage('Неверный пароль');
      }
      data.currentUser = user;
      saveData();
      updateUIOnLogin();
    }

    function logout() {
      data.currentUser = null;
      saveData();
      updateUIOnLogout();
    }

    // === Обновление UI ===
    function updateUIOnLogin() {
      inputUsername.value = '';
      inputPassword.value = '';
      clearAuthMessage();

      // Скрываем форму логина, показываем профиль
      btnLogin.style.display = 'none';
      inputUsername.style.display = 'none';
      inputPassword.style.display = 'none';

      userInfo.classList.remove('hidden');

      currentUsernameEl.textContent = data.currentUser.username;
      currentRoleEl.textContent = data.currentUser.role || 'user';
      currentRoleEl.className = data.currentUser.role ? data.currentUser.role : '';

      // Аватарка
      updateAvatar(data.currentUser);

      createTopicSection.classList.remove('hidden');

      btnLogout.style.display = 'inline-block';

      renderTopics();
    }

    function updateUIOnLogout() {
      btnLogin.style.display = 'inline-block';
      inputUsername.style.display = 'inline-block';
      inputPassword.style.display = 'inline-block';

      userInfo.classList.add('hidden');
      createTopicSection.classList.add('hidden');

      currentUsernameEl.textContent = '';
      currentRoleEl.textContent = '';
      currentRoleEl.className = '';

      clearAuthMessage();

      renderTopics();
    }

    // === Отрисовка аватарки ===
    function updateAvatar(user) {
      if (user.avatar) {
        userAvatar.style.backgroundImage = `url(${user.avatar})`;
        userAvatar.textContent = '';
        userAvatar.style.backgroundSize = 'cover';
        userAvatar.style.backgroundPosition = 'center';
      } else {
        userAvatar.style.backgroundImage = '';
        userAvatar.textContent = user.username.charAt(0).toUpperCase();
      }
    }

    // === Отрисовка списка тем ===
    function renderTopics() {
      topicsList.innerHTML = '';
      if (!data.topics.length) {
        topicsList.innerHTML = '<div class="info-text">Темы отсутствуют</div>';
        return;
      }
      data.topics.forEach(topic => {
        const div = document.createElement('div');
        div.className = 'topic';
        div.textContent = topic.title;
        topicsList.appendChild(div);
      });
    }

    // === Создание темы ===
    btnCreateTopic.onclick = () => {
      topicError.classList.add('hidden');
      const title = topicTitleInput.value.trim();
      if (title.length < 3 || title.length > 100) {
        topicError.classList.remove('hidden');
        return;
      }
      const newTopic = {
        id: Date.now(),
        title,
        posts: []
      };
      data.topics.push(newTopic);
      saveData();
      topicTitleInput.value = '';
      renderTopics();
    };

    // === Инициализация ===
    loadData();
    if (data.currentUser) {
      updateUIOnLogin();
    } else {
      updateUIOnLogout();
    }
  </script>
</body>
</html>
